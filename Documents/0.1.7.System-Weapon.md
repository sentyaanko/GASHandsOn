# System-Weapon
HeroCharacter が装備可能な武器のアクターを作成し、実際に HeroCharacter に装備できるようにし、装備時にアビリティを付与するようにする。

※このドキュメントは書きかけです。

# 方法

大まかには以下の通り。


# 手順

## ソース類

1. `GASHandsOn.Build.cs`
	* `Paper2D` モジュールの追加
		* TargetReticle 用。
		* 他のものに差し替える可能性あり。
1. `GHOHUDReticle.cpp` / `GHOHUDReticle.h` の新規作成
	* TargetReticle 用。
1. `GHOHUDWidget.cpp` / `GHOHUDWidget.h`
	* 武器用のインターフェイス追加。
1. `GHOPlayerController.cpp` / `GHOPlayerController.h`
	* 武器用の HUD 制御用インターフェイス追加。
1. `GHOGATA_Trace.cpp` / `GHOGATA_Trace.h` / `GHOGATA_LineTrace.cpp` / `GHOGATA_LineTrace.h` / `GHOGATA_SphereTrace.cpp` / `GHOGATA_SphereTrace.h` の新規作成
	* 武器用の GameplayAbility TargetActor の追加。
1. `GHOAttributeSetAmmo.cpp` / `GHOAttributeSetAmmo.h` の新規作成
	* 弾倉用の AttributeSet 。
1. `GHOPlayerState.cpp` / `GHOPlayerState.h`
	* Ammo 用 AttributeSet の追加。
1. `GHOWeapon.cpp` / `GHOWeapon.h` の新規作成
	* 武器用の Actor 。
1. `GHOHeroCharacterBase.cpp` / `GHOHeroCharacterBase.h`
	* インベントリの追加。
	* 装備中の武器追加。


## GameplayTag の追加

| タグ名                                      | 用途                                                                                           |
----------------------------------------------|------------------------------------------------------------------------------------------------|
| "Ability.Weapon"                            |  |
| "Ability.Weapon.IsChangingDelayReplication" |  |
| "Weapon.Ammo.None"                          |  |
| "Weapon.Ammo.Rifle"                         |  |
| "Weapon.Ammo.Rocket"                        |  |
| "Weapon.Ammo.Shotgun"                       |  |
| "Weapon.Equipped.None"                      |  |





以上で、 HeroCharacter で武器を使用することができるようになります。

-----
# 補足

-----
## CurrentWeapon の同期の流れ

### AutonomousProxy での CurrentWeapon の初期化
#### Case1 PlayerState -> Inventory の順にレプリケーションされた場合
![CurrentWeapon-Initialize-AutonomousProxy-Case1](http://www.plantuml.com/plantuml/proxy?cache=no&src=https://raw.githubusercontent.com/sentyaanko/GASHandsOn/featire/Add-Weapon-System/Dcuments/0.1.7/CurrentWeapon-Initialize-AutonomousProxy-Case1.puml)

#### Case2 Inventory -> PlayerState の順にレプリケーションされた（ RPC のほうが早かった）場合
![CurrentWeapon-Initialize-AutonomousProxy-Case2](http://www.plantuml.com/plantuml/proxy?cache=no&src=https://raw.githubusercontent.com/sentyaanko/GASHandsOn/featire/Add-Weapon-System/Dcuments/0.1.7/CurrentWeapon-Initialize-AutonomousProxy-Case2.puml)

### SimulatedProxy での CurrentWeapon の初期化
#### Case1 PlayerState -> CurrentWeapon の順にレプリケーションされた場合
![CurrentWeapon-Initialize-SimulatedProxy-Case1](http://www.plantuml.com/plantuml/proxy?cache=no&src=https://raw.githubusercontent.com/sentyaanko/GASHandsOn/featire/Add-Weapon-System/Dcuments/0.1.7/CurrentWeapon-Initialize-SimulatedProxy-Case1.puml)

#### Case2 CurrentWeapon -> PlayerState の順にレプリケーションされた場合
![CurrentWeapon-Initialize-SimulatedProxy-Case2](http://www.plantuml.com/plantuml/proxy?cache=no&src=https://raw.githubusercontent.com/sentyaanko/GASHandsOn/featire/Add-Weapon-System/Dcuments/0.1.7/CurrentWeapon-Initialize-SimulatedProxy-Case2.puml)

#### CurrentWeapon の変更
![CurrentWeapon-Change](http://www.plantuml.com/plantuml/proxy?cache=no&src=https://raw.githubusercontent.com/sentyaanko/GASHandsOn/featire/Add-Weapon-System/Dcuments/0.1.7/CurrentWeapon-Change.puml)

#### CurrentWeapon の同期、 AutonomousProxy で MissPrediction した際
![CurrentWeapon-Sync-AutonomousProxy-MissPrediction](http://www.plantuml.com/plantuml/proxy?cache=no&src=https://raw.githubusercontent.com/sentyaanko/GASHandsOn/featire/Add-Weapon-System/Dcuments/0.1.7/CurrentWeapon-Sync-AutonomousProxy-MissPrediction.puml)

-----
おしまい。
