# Add-AbilityTask_PlayMontageAndWaitForEvent
`AbilityTask_PlayMontageAndWaitForEvent` の実装

# 方法

* エンジン内に `AbilityTask_PlayMontageAndWait` と `AbilityTask_WaitForEvent` というものがある。
* Epic のサンプルである `ActionRPG` にその機能を統合した `AbilityTask_PlayMontageAndWaitForEvent` がある。
	* `AbilityTask_PlayMontageAndWaitForEvent` は２つのクラスを統合したもので、どちらのクラスからも継承関係はない。
* `GASDocumentation` にあるのは上記と同じものである。

# 手順

* 基本的にはソースをそのまま持ってきた後、コメントの和訳を追加しているだけです。
* 機能の詳細については以下の公式ドキュメント参照
	* [Unreal Engine 4 Documentation > Samples and Tutorials > Example Game Projects > Action RPG Game > Gameplay Abilities in Action RPG > Melee Abilities In ARPG](https://docs.unrealengine.com/en-US/Resources/SampleGames/ARPG/GameplayAbilitiesinActionRPG/MeleeAbilitiesInARPG/index.html)
	* [Unreal Engine 4 ドキュメント > サンプルとチュートリアル > サンプル ゲーム プロジェクト > Action RPG Game サンプル プロジェクト > Action RPG のゲームプレイ アビリティ > ARPG のメレー アビリティ](https://docs.unrealengine.com/ja/Resources/SampleGames/ARPG/GameplayAbilitiesinActionRPG/MeleeAbilitiesInARPG/index.html)

-----
# 補足

-----
## AbilityTask

```c++
/**
 *	AbilityTasks are small, self contained operations that can be performed while executing an ability.
 *	They are latent/asynchronous is nature. They will generally follow the pattern of 'start something and wait until it is finished or interrupted'
 *	
 *	We have code in K2Node_LatentAbilityCall to make using these in blueprints streamlined. The best way to become familiar with AbilityTasks is to 
 *	look at existing tasks like UAbilityTask_WaitOverlap (very simple) and UAbilityTask_WaitTargetData (much more complex).
 *	
 *	These are the basic requirements for using an ability task:
 *	
 *	1) Define dynamic multicast, BlueprintAssignable delegates in your AbilityTask. These are the OUTPUTs of your task. When these delegates fire,
 *	execution resumes in the calling blueprints.
 *	
 *	2) Your inputs are defined by a static factory function which will instantiate an instance of your task. The parameters of this function define
 *	the INPUTs into your task. All the factory function should do is instantiate your task and possibly set starting parameters. It should NOT invoke
 *	any of the callback delegates!
 *	
 *	3) Implement a Activate() function (defined here in base class). This function should actually start/execute your task logic. It is safe to invoke
 *	callback delegates here.
 *	
 *	
 *	This is all you need for basic AbilityTasks. 
 *	
 *	
 *	CheckList:
 *		-Override ::OnDestroy() and unregister any callbacks that the task registered. Call Super::EndTask too!
 *		-Implemented an Activate function which truly 'starts' the task. Do not 'start' the task in your static factory function!
 *	
 *	
 *	--------------------------------------
 *	
 *	We have additional support for AbilityTasks that want to spawn actors. Though this could be accomplished in an Activate() function, it would not be
 *	possible to pass in dynamic "ExposeOnSpawn" actor properties. This is a powerful feature of blueprints, in order to support this, you need to implement 
 *	a different step 3:
 *	
 *	Instead of an Activate() function, you should implement a BeginSpawningActor() and FinishSpawningActor() function.
 *	
 *	BeginSpawningActor() must take in a TSubclassOf<YourActorClassToSpawn> parameters named 'Class'. It must also have a out reference parameters of type 
 *	YourActorClassToSpawn*& named SpawnedActor. This function is allowed to decide whether it wants to spawn the actor or not (useful if wishing to
 *	predicate actor spawning on network authority).
 *	
 *	BeginSpawningActor() can instantiate an actor with SpawnActorDefferred. This is important, otherwise the UCS will run before spawn parameters are set.
 *	BeginSpawningActor() should also set the SpawnedActor parameter to the actor it spawned.
 *	
 *	[Next, the generated byte code will set the expose on spawn parameters to whatever the user has set]
 *	
 *	If you spawned something, FinishSpawningActor() will be called and pass in the same actor that was just spawned. You MUST call ExecuteConstruction + PostActorConstruction
 *	on this actor!
 *	
 *	This is a lot of steps but in general, AbilityTask_SpawnActor() gives a clear, minimal example.
 *	
 *	
 */
/*
和訳
	AbilityTask は、アビリティの実行中に行うことができる、小さな独立したオペレーションです。
	彼らの性質は latent/asynchronous （潜伏性/非同期性）です。彼らは一般的に「何かを初めて、それが終わるか中断されるまで待つ」というパターンを取ります。
	
	K2Node_LatentAbilityCall には、これらを BluePrint で使用するためおコードが用意されています。
	AbilityTask に慣れる一番良い方法は、 UAbilityTask_WaitOverlap (非常にシンプル) や UAbilityTask_WaitTargetData (遥かに複雑) のようなの既存のタスクを見ることです。

	これらはアビリティタスクを使用するための基本的な条件です:
	
	1) あなたの AbilityTask に、 dynamic multicast で BlueprintAssignable なデリゲートを定義します。
	これらはタスクの出力です。
	これらのデリゲートが発火すると、呼び出した BluePrint で実行が再開されます。
	
	2) あなたの入力は、タスクをインスタンス化する static なファクトリ関数によって定義されます。
	この関数のパラメータは、タスクへの入力を定義します。
	ファクトリ関数は、タスクのインスタンスを生成し、場合によっては開始パラメータを設定するだけです。
	コールバックデリゲートを呼び出してはいけません。
	
	3) Activate() を実装します（ベースクラスで定義します）。
	この関数はあなたのタスクロジックを実際に開始/実行するためのものです。
	ここでコールバックデリゲートを呼び出しても安全です。
	
	
	基本的な AbilityTask に必要なものはこれだけです。
	
	
	チェックリスト:
		-::OnDestroy() をオーバーライドし、タスが登録したコールバックの登録を解除します。Super::EndTask も呼び出してください!
		-タスクを真に「開始」する Activate 関数を実装しました。 static なファクトリ関数でタスクを「開始」してはいけません！
	
	
	--------------------------------------
	
	アクターをスポーンさせたい AbilityTask へのサポートを追加しました。
	これは Activate() 関数で実現できますが、ダイナミックな「 ExposeOnSpawn 」アクターパラメータを渡すことは出来ません。
	これは BluePinrt の強力な機能ですが、これをサポートするためには、別のステップ３を実装する必要があります。
	
	Activate() 関数の代わりに、BeginSpawningActor() 関数と FinishSpawningActor() 関数を実装する必要があります。
	
	BeginSpawningActor() は 'Class' という名前の TSubclassOf<YourActorClassToSpawn> パラメータを受け取らなければなりません。
	また、 SpawnedActor という名前の YourActorClassToSpawn*& 型の出力用の参照パラメータを持たなければなりません。
	この関数はアクターをスポーンするかどうかを決定することが出来ます（アクターのスポーンをネットワークの権限に基づいて決定したい場合に便利です）。
	
	訳注：UCS=UserConstructionScript

	BeginSpawningActor() は SpawnActorDefferred を持つアクターをインスタンス化することが出来ます。これは重要で、さもないとスポーンパラメータが設定される前に UCS が実行されてしまいます。
	BeginSpawningActor() は、 SpawnedActor パラメータをスポーンしたアクターに設定する必要があります。
	
	[次に、生成されたバイトコードでは、スポーンのパラメータの expose をユーザーが設定したものに設定します。]
	
	何かをスポーンした場合、 FinishSpawningActor() が呼び出され、スポーンされたばかりの同じアクタが渡されます。
	このアクターで ExecuteConstruction + PostActorConstruction を呼び出さなければなりません！
	
	これは多くのステップを踏んでいますが、一般的には  AbilityTask_SpawnActor() が明確で最小限の例を示しています。
	This is a lot of steps but in general, AbilityTask_SpawnActor() gives a clear, minimal example.
*/
```


-----
おしまい。
